import{s as u,l as o}from"./app-yE3FpRTR.js";const h=u("auth",{state:()=>({user:null,token:localStorage.getItem("token")||null,loading:!1,error:null}),getters:{isAuthenticated:e=>!!e.user&&!!e.token,isAdmin:e=>{var r;return((r=e.user)==null?void 0:r.role)==="admin"},isManager:e=>{var r;return((r=e.user)==null?void 0:r.role)==="manager"},isUser:e=>{var r;return((r=e.user)==null?void 0:r.role)==="user"},userRole:e=>{var r;return(r=e.user)==null?void 0:r.role}},actions:{async initialize(){if(this.token)try{await this.fetchUser()}catch{this.logout()}},async login(e){var r,t,i,n;this.loading=!0,this.error=null;try{const s=await o.post("/api/login",e);if(s.data.success){const{user:l,token:a}=s.data.data;return this.user=l,this.token=a,localStorage.setItem("token",a),o.defaults.headers.common.Authorization=`Bearer ${a}`,{success:!0}}return{success:!1,error:"Login failed"}}catch(s){return this.error=((t=(r=s.response)==null?void 0:r.data)==null?void 0:t.message)||"Login failed. Please check your credentials.",(n=(i=s.response)==null?void 0:i.data)!=null&&n.errors?{success:!1,errors:s.response.data.errors}:{success:!1,error:this.error}}finally{this.loading=!1}},async register(e){var r,t,i,n;this.loading=!0,this.error=null;try{const s=await o.post("/api/register",e);if(s.data.success){const{user:l,token:a}=s.data.data;return this.user=l,this.token=a,localStorage.setItem("token",a),o.defaults.headers.common.Authorization=`Bearer ${a}`,{success:!0}}return{success:!1,error:"Registration failed"}}catch(s){return this.error=((t=(r=s.response)==null?void 0:r.data)==null?void 0:t.message)||"Registration failed",(n=(i=s.response)==null?void 0:i.data)!=null&&n.errors?{success:!1,errors:s.response.data.errors}:{success:!1,error:this.error}}finally{this.loading=!1}},async fetchUser(){var e,r;if(this.token){this.loading=!0,this.error=null;try{const t=await o.get("/api/user");return t.data.success?(this.user=t.data.data,{success:!0}):{success:!1}}catch(t){return this.error=((r=(e=t.response)==null?void 0:e.data)==null?void 0:r.message)||"Failed to fetch user data",{success:!1,error:this.error}}finally{this.loading=!1}}},async logout(){this.loading=!0;try{this.token&&await o.post("/api/logout")}catch(e){console.error("Error during logout:",e)}finally{this.user=null,this.token=null,this.error=null,localStorage.removeItem("token"),delete o.defaults.headers.common.Authorization,this.loading=!1}}}});export{h as u};
