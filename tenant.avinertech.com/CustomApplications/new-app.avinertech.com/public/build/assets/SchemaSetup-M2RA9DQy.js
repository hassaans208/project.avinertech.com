import{d as a,c as w,a as g,f as s,b,g as T,F as V,h as E,t as U,m as j,w as B,v as A,z as O}from"./app-Ccdyq44E.js";import I from"./Breadcrumbs-LUO-aByO.js";import z from"./MessageBox-B6lWDncq.js";import J from"./ConfirmDialog-Dn3uV_Qd.js";import"./Select2-CY8QQe8M.js";import R from"./SchemaModelListItem-DX4UKNQZ.js";import P from"./SchemaModelModal-M66lWlkL.js";import G from"./DashboardLayout-ncZCbfQr.js";/* empty css            */import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./SchemaModelDetails-1OPqfc55.js";import"./SchemaField-CFFjRgPC.js";import"./auth-By0yUZmG.js";const H={class:"h-screen flex flex-col overflow-hidden"},K={class:"flex-none space-y-8 p-6"},Q={class:"flex-1 overflow-hidden px-6 pb-6"},W={class:"bg-white/10 backdrop-blur-lg rounded-xl border border-white/20 h-full flex flex-col"},X={class:"flex-1 overflow-y-auto p-6"},Y={class:"space-y-4"},Z={key:0,class:"fixed inset-0 z-50 overflow-hidden"},ee={class:"fixed inset-0 flex items-center justify-center p-4"},le={class:"w-full max-w-2xl bg-gray-800 rounded-xl border border-white/10 shadow-xl"},se={class:"flex items-center justify-between p-4 border-b border-white/10"},te={class:"text-lg font-medium text-white"},ae={class:"p-4"},ne={class:"space-y-4"},ye=Object.assign({layout:G},{__name:"SchemaSetup",setup(oe){const c=a(!1),f=a(!1),o=a(null),x=a(null),m=a(null),_=a("info"),h=a(!1),t=a({name:"",tableType:"regular",description:"",fields:[]}),i=a([{name:"User",tableType:"regular",description:"User management and authentication",fields:[{name:"id",type:"integer",nullable:!1,unique:!0,indexed:!0},{name:"name",type:"string",length:255,nullable:!1,unique:!1,indexed:!0},{name:"email",type:"string",length:255,nullable:!1,unique:!0,indexed:!0,encrypted:!0},{name:"password",type:"string",length:255,nullable:!1,unique:!1,indexed:!1,encrypted:!0},{name:"created_at",type:"datetime",nullable:!1,unique:!1,indexed:!1}]},{name:"Post",tableType:"regular",description:"Blog posts and articles",fields:[{name:"id",type:"integer",nullable:!1,unique:!0,indexed:!0},{name:"title",type:"string",length:255,nullable:!1,unique:!1,indexed:!0},{name:"content",type:"text",nullable:!1,unique:!1,indexed:!1},{name:"user_id",type:"integer",nullable:!1,unique:!1,indexed:!0},{name:"status",type:"string",length:20,nullable:!1,unique:!1,indexed:!0},{name:"published_at",type:"datetime",nullable:!0,unique:!1,indexed:!0}]},{name:"UserRole",tableType:"pivot",description:"User role assignments",fields:[{name:"user_id",type:"integer",nullable:!1,unique:!1,indexed:!0},{name:"role_id",type:"integer",nullable:!1,unique:!1,indexed:!0},{name:"assigned_at",type:"datetime",nullable:!1,unique:!1,indexed:!1}]}]),y=a(!1),u=a(""),d=a(null),k=()=>{o.value=null,t.value={name:"",fields:[]},c.value=!0},C=e=>{o.value=e,t.value=JSON.parse(JSON.stringify(e)),c.value=!0},M=()=>{c.value=!1,o.value=null,t.value={name:"",fields:[]}},q=()=>{t.value.fields.push({name:"",type:"string",nullable:!1,unique:!1,indexed:!1,encrypted:!1,length:null,logic:""})},D=e=>{t.value.fields.splice(e,1)},F=e=>{x.value=e,confirmDialogMessage.value=`Are you sure you want to delete the "${e.name}" model? This action cannot be undone.`,f.value=!0},L=async()=>{try{const e=i.value.findIndex(l=>l.name===x.value.name);e!==-1&&(i.value.splice(e,1),v("Model deleted successfully","success"))}catch{v("Failed to delete model","error")}finally{f.value=!1,x.value=null}},v=(e,l="info")=>{m.value=e,_.value=l},S=async()=>{h.value=!0;try{if(o.value){const e=i.value.findIndex(l=>l.name===o.value.name);e!==-1&&(i.value[e]={...t.value})}else i.value.push({...t.value});v("Model saved successfully","success"),M()}catch(e){console.error("Error saving model:",e),v("Failed to save model","error")}finally{h.value=!1}},$=({index:e,logic:l})=>{var r,n;if(console.log("Opening logic modal:",{index:e,logic:l}),!((n=(r=t.value)==null?void 0:r.fields)!=null&&n[e])){console.error("Field not found:",e);return}d.value=t.value.fields[e],u.value=l||"",y.value=!0},p=()=>{y.value=!1,u.value="",d.value=null},N=()=>{if(d.value){const e=t.value.fields.findIndex(l=>l===d.value);e!==-1&&(t.value.fields[e].logic=u.value)}p()};return(e,l)=>{var r;return g(),w("div",H,[s("div",K,[b(I,{items:[{name:"Setup",path:"setup.index"},{name:"Database Schema"}]}),s("div",{class:"flex items-center justify-between"},[l[4]||(l[4]=s("h1",{class:"text-3xl font-bold text-white"},"Database Schema",-1)),s("button",{onClick:k,class:"px-4 py-2 bg-purple-500/20 hover:bg-purple-500/30 text-purple-300 rounded-lg transition-colors"}," Add New Model ")])]),s("div",Q,[s("div",W,[s("div",X,[s("div",Y,[(g(!0),w(V,null,E(i.value,n=>(g(),O(R,{key:n.name,model:n,onEdit:C,onDelete:F},null,8,["model"]))),128))])])])]),b(P,{modelValue:t.value,"onUpdate:modelValue":l[0]||(l[0]=n=>t.value=n),show:c.value,"is-editing":!!o.value,"is-saving":h.value,onClose:M,onSave:S,onAddField:q,onRemoveField:D,onEditLogic:$},null,8,["modelValue","show","is-editing","is-saving"]),y.value?(g(),w("div",Z,[s("div",{class:"fixed inset-0 bg-black/50 backdrop-blur-sm",onClick:p}),s("div",ee,[s("div",le,[s("div",se,[s("h3",te," Field Logic: "+U(((r=d.value)==null?void 0:r.name)||"Untitled Field"),1),s("button",{onClick:p,class:"text-gray-400 hover:text-white"},l[5]||(l[5]=[s("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))]),s("div",ae,[s("div",ne,[s("div",null,[l[6]||(l[6]=s("label",{class:"block text-sm font-medium text-gray-400 mb-2"}," Logic Expression ",-1)),B(s("textarea",{"onUpdate:modelValue":l[1]||(l[1]=n=>u.value=n),rows:"6",class:"w-full px-4 py-2 bg-white/5 border border-white/10 rounded-lg text-white focus:outline-none focus:border-blue-500 font-mono text-sm",placeholder:"Enter field logic expression..."},null,512),[[A,u.value]])]),l[7]||(l[7]=j('<div class="text-sm text-gray-400"><p>Available variables:</p><ul class="list-disc list-inside mt-2 space-y-1"><li><code class="text-blue-400">$value</code> - Current field value</li><li><code class="text-blue-400">$model</code> - Current model data</li><li><code class="text-blue-400">$user</code> - Current user data</li></ul></div>',1))])]),s("div",{class:"flex justify-end gap-3 p-4 border-t border-white/10"},[s("button",{onClick:p,class:"px-4 py-2 bg-white/10 hover:bg-white/20 text-white rounded-lg transition-colors"}," Cancel "),s("button",{onClick:N,class:"px-4 py-2 bg-blue-500/20 hover:bg-blue-500/30 text-blue-300 rounded-lg transition-colors"}," Save Logic ")])])])])):T("",!0),b(z,{show:!!m.value,message:m.value,type:_.value,onClose:l[2]||(l[2]=n=>m.value=null)},null,8,["show","message","type"]),b(J,{show:f.value,title:"Delete Model",message:e.confirmDialogMessage,type:"danger","confirm-text":"Delete",onConfirm:L,onCancel:l[3]||(l[3]=n=>f.value=!1)},null,8,["show","message"])])}}});export{ye as default};
